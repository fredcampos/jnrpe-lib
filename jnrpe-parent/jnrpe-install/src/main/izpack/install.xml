<?xml version="1.0" encoding="iso-8859-1" standalone="yes" ?>
<installation version="5.0">
	<info>
		<appname>JNRPE</appname>
		<appversion>${project.version}</appversion>
		<authors>
			<author name="Massimiliano Ziccardi" email="massimiliano.ziccardi@gmail.com" />
		</authors>
		<url>http://jnrpe.sourceforge.net</url>
		<javaversion>1.6</javaversion>
		<requiresjdk>no</requiresjdk>
	</info>

	<guiprefs width="640" height="480" resizable="yes" />

	<locale>
		<langpack iso3="eng" />
	</locale>

	<resources>
		<res id="LicencePanel.licence" src="../../src/main/izpack/LICENSE.txt" />
	</resources>

	<panels>
		<panel classname="HelloPanel" />
		<panel classname="LicencePanel" />
		<panel classname="TargetPanel" />
		<panel classname="PacksPanel" />
		<panel classname="InstallPanel" />
		<panel classname="FinishPanel" />
	</panels>

	<conditions>
		<condition type="packselection" id="windowServiceSelected">
			<name>Windows Service</name>
		</condition>
		<condition type="packselection" id="unixDaemonSelected">
			<name>Unix Daemon</name>
		</condition>

		<condition type="or" id="wrapperRequired">
			<condition type="ref" refid="windowServiceSelected" />
			<condition type="ref" refid="unixDaemonSelected" />
		</condition>

		<condition type="empty" id="localeAppDataIsEmpty">
			<string>${ENV[LOCALAPPDATA]}</string>
		</condition>
		
		<condition type="not" id="localeAppDataIsNotEmpty">
			<condition type="ref" refid="localeAppDataIsEmpty" />
		</condition>
	</conditions>

	<dynamicvariables>
		<variable name="LOGDIR" condition="localeAppDataIsEmpty">
			<value>$INSTALL_PATH/log</value>
		</variable>

		<variable name="LOGDIR" condition="localeAppDataIsNotEmpty">
			<value>${ENV[LOCALAPPDATA]}/JNRPE/log</value>
		</variable>
		
		<variable name="WRAPPER_JNATMP" condition="localeAppDataIsEmpty">
			<value>$INSTALL_PATH/wrapper</value>
		</variable>
		
		<variable name="WRAPPER_JNATMP" condition="localeAppDataIsNotEmpty">
			<value>${ENV[LOCALAPPDATA]}/JNRPE</value>
		</variable>
		
		<variable name="SERVICE_NAME" os="windows">
			<value>JNRPE Server</value>
		</variable>
		
		<variable name="SERVICE_NAME" os="unix">
			<value>jnrpe</value>
		</variable>
	</dynamicvariables>

	<packs>

		<pack name="Core" required="yes">
			<description>Core installation files</description>
			<fileset dir="../../target/staging/dependency" targetdir="$INSTALL_PATH/lib"
				unpack="false">
				<include name="*.jar" />
				<!-- <exclude name="jnrpe-server*.jar"/> -->
				<exclude name="jnrpe-plugins*.jar" />
			</fileset>

			<file src="../../src/scripts/unix/jnrpe" targetdir="$INSTALL_PATH/bin"
				os="unix" unpack="false" />
			<executable targetfile="$INSTALL_PATH/bin/jnrpe" os="unix" />
			<file src="../../src/config/log4j.properties" targetdir="$INSTALL_PATH/etc"
				unpack="false" />
				
			<parsable targetfile="$INSTALL_PATH/etc/log4j.properties"
				type="javaprop" />
		</pack>

		<pack name="Sample Config" required="yes">
			<description>Sample configuration file</description>
			<file src="../../src/config/jnrpe.ini" targetdir="$INSTALL_PATH/etc"
				unpack="false" />
		</pack>

		<pack name="Base Plugins" required="no">
			<description>The plugins provided with JNRPE</description>
			<fileset dir="../../target/staging/dependency" targetdir="$INSTALL_PATH/plugins/base"
				unpack="false">
				<include name="jnrpe-plugins*.jar" />
			</fileset>
		</pack>

		<pack name="serviceWrapper" required="no" hidden="true"
			condition="wrapperRequired">
			<description>YAJSW packaging</description>

			<file src="../../src/wrapper/jnrpeservice.log" targetdir="$LOGDIR"
				unpack="false" />
			<file src="../../src/wrapper/wrapper.conf" targetdir="$INSTALL_PATH/wrapper/etc"
				unpack="false" />
			<file src="../../src/wrapper/wrapper.jar" targetdir="$INSTALL_PATH/wrapper"
				unpack="false" />
			<file src="../../src/wrapper/wrapperApp.jar" targetdir="$INSTALL_PATH/wrapper"
				unpack="false" />

			<fileset dir="../../src/wrapper/deps" targetdir="$INSTALL_PATH/wrapper/lib"
				unpack="false">
				<include name="**/*" />
			</fileset>

			<fileset dir="../../src/wrapper/unix_deps" targetdir="$INSTALL_PATH/wrapper/lib" os="unix"
				unpack="false">
				<include name="**/*" />
			</fileset>

			<fileset dir="../../src/wrapper/templates" targetdir="$INSTALL_PATH/wrapper/templates" os="unix"
				unpack="false">
				<include name="**/*" />
			</fileset>

			<parsable targetfile="$INSTALL_PATH/wrapper/etc/wrapper.conf"
				type="javaprop" />
				
			<executable targetfile="$JAVA_HOME/bin/java" stage="postinstall" keep="true">
				<args>
					<arg value="-jar" />
					<arg value="$INSTALL_PATH/wrapper/wrapper.jar"/>
					<arg value="-i" />
					<arg value="$INSTALL_PATH/wrapper/etc/wrapper.conf" />
				</args>
			</executable>

			<executable targetfile="$JAVA_HOME/bin/java" stage="uninstall" keep="true">
				<args>
					<arg value="-jar" />
					<arg value="$INSTALL_PATH/wrapper/wrapper.jar"/>
					<arg value="-r" />
					<arg value="$INSTALL_PATH/wrapper/etc/wrapper.conf" />
				</args>
			</executable>

		</pack>

		<pack name="Windows Service" required="no" os="windows">
			<description>Register the server as Window Service</description>

			<file src="../../src/wrapper/fixconf.bat" targetdir="$INSTALL_PATH"
				unpack="false" os="windows" />
			<parsable targetfile="$INSTALL_PATH/fixconf.bat" type="plain"
				os="windows" />
			<executable targetfile="$INSTALL_PATH/fixconf.bat" stage="postinstall"
				os="windows" keep="false" />


			<executable targetfile="$JAVA_HOME/bin/java" stage="postinstall" keep="true">
				<args>
					<arg value="-jar" />
					<arg value="$INSTALL_PATH/wrapper/wrapper.jar"/>
					<arg value="-i" />
					<arg value="$INSTALL_PATH/wrapper/etc/wrapper.conf" />
				</args>
			</executable>
			
		</pack>

		<pack name="Unix Daemon" required="no" os="unix">
			<description>Installs JNRPE as a unix daemon</description>

			<file src="../../src/wrapper/fixconf.sh" targetdir="$INSTALL_PATH"
				unpack="false" />
			<parsable targetfile="$INSTALL_PATH/fixconf.sh" type="plain" />
			<executable targetfile="$INSTALL_PATH/fixconf.sh" stage="postinstall"
				keep="false" />
		</pack>

	</packs>

</installation>